<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.38.0 (20140413.2041)
 -->
<!-- Title: G Pages: 1 -->
<svg width="723pt" height="690pt"
 viewBox="0.00 0.00 723.44 690.44" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(0.72 689.72)">
<title>G</title>
<polygon fill="white" stroke="none" points="-0.72,0.72 -0.72,-689.72 722.72,-689.72 722.72,0.72 -0.72,0.72"/>
<g id="clust1" class="cluster"><title>cluster_______VM_VCPU_________</title>
<polygon fill="white" stroke="black" points="8,-8 8,-681 714,-681 714,-8 8,-8"/>
<text text-anchor="middle" x="361" y="-665" font-family="Consolas:bold" font-size="15.00">后期用于实现VM、VCPU管理的几个基础接口</text>
</g>
<!-- vcpu_disable() -->
<g id="node1" class="node"><title>vcpu_disable()</title>
<path fill="#ffffbf" stroke="#800000" d="M340.5,-217.5C340.5,-217.5 507.5,-217.5 507.5,-217.5 513.5,-217.5 519.5,-223.5 519.5,-229.5 519.5,-229.5 519.5,-259.5 519.5,-259.5 519.5,-265.5 513.5,-271.5 507.5,-271.5 507.5,-271.5 340.5,-271.5 340.5,-271.5 334.5,-271.5 328.5,-265.5 328.5,-259.5 328.5,-259.5 328.5,-229.5 328.5,-229.5 328.5,-223.5 334.5,-217.5 340.5,-217.5"/>
<text text-anchor="middle" x="424" y="-260.3" font-family="Consolas" font-size="9.00">vcpu_disable()</text>
<polyline fill="none" stroke="#800000" points="328.5,-253.5 519.5,-253.5 "/>
<text text-anchor="middle" x="424" y="-242.3" font-family="Consolas" font-size="9.00">parameter can be [NULL(current)│vcpu]</text>
<polyline fill="none" stroke="#800000" points="328.5,-235.5 519.5,-235.5 "/>
<text text-anchor="middle" x="424" y="-224.3" font-family="Consolas" font-size="9.00">Pre: save&#45;brkpoint</text>
</g>
<!-- 上下文保存范围的设计 -->
<g id="node2" class="node"><title>上下文保存范围的设计</title>
<polygon fill="aliceblue" stroke="#800000" stroke-dasharray="5,2" points="506,-298.5 506,-384.5 706,-384.5 706,-298.5 506,-298.5"/>
<text text-anchor="middle" x="606" y="-373.3" font-family="Consolas" font-size="9.00">上下文保存范围的设计</text>
<polyline fill="none" stroke="#800000" stroke-dasharray="5,2" points="506,-366.5 706,-366.5 "/>
<text text-anchor="middle" x="606" y="-355.3" font-family="Consolas" font-size="9.00">平台只在单VM时使用，</text>
<text text-anchor="middle" x="606" y="-345.3" font-family="Consolas" font-size="9.00">所以保存的上下文较少，</text>
<text text-anchor="middle" x="606" y="-335.3" font-family="Consolas" font-size="9.00">只有当多VM时才需进一步增加上下文的保存，</text>
<text text-anchor="middle" x="606" y="-325.3" font-family="Consolas" font-size="9.00">比如gic，</text>
<text text-anchor="middle" x="606" y="-315.3" font-family="Consolas" font-size="9.00">vtimer，</text>
<text text-anchor="middle" x="606" y="-305.3" font-family="Consolas" font-size="9.00">turn on/off mmu等</text>
</g>
<!-- 上下文保存范围的设计&#45;&gt;vcpu_disable() -->
<g id="edge1" class="edge"><title>上下文保存范围的设计&#45;&gt;vcpu_disable()</title>
<path fill="none" stroke="black" stroke-width="0.5" stroke-dasharray="5,2" d="M525.377,-298.417C507.882,-289.285 489.869,-279.882 473.969,-271.583"/>
</g>
<!-- vcpu_enable(vcpu) -->
<g id="node3" class="node"><title>vcpu_enable(vcpu)</title>
<path fill="#ffffbf" stroke="#800000" d="M413.5,-16.5C413.5,-16.5 484.5,-16.5 484.5,-16.5 490.5,-16.5 496.5,-22.5 496.5,-28.5 496.5,-28.5 496.5,-40.5 496.5,-40.5 496.5,-46.5 490.5,-52.5 484.5,-52.5 484.5,-52.5 413.5,-52.5 413.5,-52.5 407.5,-52.5 401.5,-46.5 401.5,-40.5 401.5,-40.5 401.5,-28.5 401.5,-28.5 401.5,-22.5 407.5,-16.5 413.5,-16.5"/>
<text text-anchor="middle" x="449" y="-41.3" font-family="Consolas" font-size="9.00">vcpu_enable(vcpu)</text>
<polyline fill="none" stroke="#800000" points="401.5,-34.5 496.5,-34.5 "/>
<text text-anchor="middle" x="449" y="-23.3" font-family="Consolas" font-size="9.00">Pre: isb</text>
</g>
<!-- 上下文保存范围的设计&#45;&gt;vcpu_enable(vcpu) -->
<g id="edge2" class="edge"><title>上下文保存范围的设计&#45;&gt;vcpu_enable(vcpu)</title>
<path fill="none" stroke="black" stroke-width="0.5" stroke-dasharray="5,2" d="M583.892,-298.124C577.398,-282.079 572,-263.368 572,-245.5 572,-245.5 572,-245.5 572,-96.5 572,-61.3419 531.167,-46.4476 496.555,-40.1378"/>
</g>
<!-- vcpu_restore() -->
<g id="node4" class="node"><title>vcpu_restore()</title>
<path fill="#ffffbf" stroke="#800000" d="M379.5,-70.5C379.5,-70.5 518.5,-70.5 518.5,-70.5 524.5,-70.5 530.5,-76.5 530.5,-82.5 530.5,-82.5 530.5,-112.5 530.5,-112.5 530.5,-118.5 524.5,-124.5 518.5,-124.5 518.5,-124.5 379.5,-124.5 379.5,-124.5 373.5,-124.5 367.5,-118.5 367.5,-112.5 367.5,-112.5 367.5,-82.5 367.5,-82.5 367.5,-76.5 373.5,-70.5 379.5,-70.5"/>
<text text-anchor="middle" x="449" y="-113.3" font-family="Consolas" font-size="9.00">vcpu_restore()</text>
<polyline fill="none" stroke="#800000" points="367.5,-106.5 530.5,-106.5 "/>
<text text-anchor="middle" x="449" y="-95.3" font-family="Consolas" font-size="9.00">Pre: isb + restore vgic(vmcr/apr/lr)</text>
<polyline fill="none" stroke="#800000" points="367.5,-88.5 530.5,-88.5 "/>
<text text-anchor="middle" x="449" y="-77.3" font-family="Consolas" font-size="9.00">需配合vcpu_save()</text>
</g>
<!-- vcpu_restore()&#45;&gt;vcpu_enable(vcpu) -->
<g id="edge4" class="edge"><title>vcpu_restore()&#45;&gt;vcpu_enable(vcpu)</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M449,-70.2765C449,-66.0988 449,-61.8119 449,-57.7378"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="449,-52.7152 451.25,-57.7152 449,-55.2152 449,-57.7152 449,-57.7152 449,-57.7152 449,-55.2152 446.75,-57.7153 449,-52.7152 449,-52.7152"/>
</g>
<!-- 如果只是vcpu之间的切换，\n使用vcpu_enable()过重，\n仍有优化空间，\n比如不需要重复开启vgic -->
<g id="node5" class="node"><title>如果只是vcpu之间的切换，\n使用vcpu_enable()过重，\n仍有优化空间，\n比如不需要重复开启vgic</title>
<polygon fill="aliceblue" stroke="#800000" stroke-dasharray="5,2" points="418,-151.5 418,-199.5 544,-199.5 544,-151.5 418,-151.5"/>
<text text-anchor="middle" x="481" y="-188.3" font-family="Consolas" font-size="9.00">如果只是vcpu之间的切换，</text>
<text text-anchor="middle" x="481" y="-178.3" font-family="Consolas" font-size="9.00">使用vcpu_enable()过重，</text>
<text text-anchor="middle" x="481" y="-168.3" font-family="Consolas" font-size="9.00">仍有优化空间，</text>
<text text-anchor="middle" x="481" y="-158.3" font-family="Consolas" font-size="9.00">比如不需要重复开启vgic</text>
</g>
<!-- 如果只是vcpu之间的切换，\n使用vcpu_enable()过重，\n仍有优化空间，\n比如不需要重复开启vgic&#45;&gt;vcpu_restore() -->
<g id="edge3" class="edge"><title>如果只是vcpu之间的切换，\n使用vcpu_enable()过重，\n仍有优化空间，\n比如不需要重复开启vgic&#45;&gt;vcpu_restore()</title>
<path fill="none" stroke="black" stroke-width="0.5" stroke-dasharray="5,2" d="M471.225,-151.285C467.696,-142.903 463.688,-133.385 460.057,-124.761"/>
</g>
<!-- vcpu_save(vcpu,\n isActive) -->
<g id="node6" class="node"><title>vcpu_save(vcpu,\n isActive)</title>
<path fill="#ffffbf" stroke="#800000" d="M166.5,-221.5C166.5,-221.5 297.5,-221.5 297.5,-221.5 303.5,-221.5 309.5,-227.5 309.5,-233.5 309.5,-233.5 309.5,-255.5 309.5,-255.5 309.5,-261.5 303.5,-267.5 297.5,-267.5 297.5,-267.5 166.5,-267.5 166.5,-267.5 160.5,-267.5 154.5,-261.5 154.5,-255.5 154.5,-255.5 154.5,-233.5 154.5,-233.5 154.5,-227.5 160.5,-221.5 166.5,-221.5"/>
<text text-anchor="middle" x="232" y="-256.3" font-family="Consolas" font-size="9.00">vcpu_save(vcpu,</text>
<text text-anchor="middle" x="232" y="-246.3" font-family="Consolas" font-size="9.00"> isActive)</text>
<polyline fill="none" stroke="#800000" points="154.5,-239.5 309.5,-239.5 "/>
<text text-anchor="middle" x="232" y="-228.3" font-family="Consolas" font-size="9.00">dsb + sysregs + save timer &amp; vgic</text>
</g>
<!-- 可用于实现vm/vcpu的halt/resume -->
<g id="node7" class="node"><title>可用于实现vm/vcpu的halt/resume</title>
<path fill="#ffffbf" stroke="#800000" d="M465.5,-611.5C465.5,-611.5 600.5,-611.5 600.5,-611.5 606.5,-611.5 612.5,-617.5 612.5,-623.5 612.5,-623.5 612.5,-635.5 612.5,-635.5 612.5,-641.5 606.5,-647.5 600.5,-647.5 600.5,-647.5 465.5,-647.5 465.5,-647.5 459.5,-647.5 453.5,-641.5 453.5,-635.5 453.5,-635.5 453.5,-623.5 453.5,-623.5 453.5,-617.5 459.5,-611.5 465.5,-611.5"/>
<text text-anchor="middle" x="533" y="-627.3" font-family="Consolas" font-size="9.00">可用于实现vm/vcpu的halt/resume</text>
</g>
<!-- associateVCPUTCB(vcpu,\n tcb) -->
<g id="node8" class="node"><title>associateVCPUTCB(vcpu,\n tcb)</title>
<path fill="#ffffbf" stroke="#800000" d="M412.5,-556.5C412.5,-556.5 511.5,-556.5 511.5,-556.5 517.5,-556.5 523.5,-562.5 523.5,-568.5 523.5,-568.5 523.5,-580.5 523.5,-580.5 523.5,-586.5 517.5,-592.5 511.5,-592.5 511.5,-592.5 412.5,-592.5 412.5,-592.5 406.5,-592.5 400.5,-586.5 400.5,-580.5 400.5,-580.5 400.5,-568.5 400.5,-568.5 400.5,-562.5 406.5,-556.5 412.5,-556.5"/>
<text text-anchor="middle" x="462" y="-577.3" font-family="Consolas" font-size="9.00">associateVCPUTCB(vcpu,</text>
<text text-anchor="middle" x="462" y="-567.3" font-family="Consolas" font-size="9.00"> tcb)</text>
</g>
<!-- 可用于实现vm/vcpu的halt/resume&#45;&gt;associateVCPUTCB(vcpu,\n tcb) -->
<g id="edge5" class="edge"><title>可用于实现vm/vcpu的halt/resume&#45;&gt;associateVCPUTCB(vcpu,\n tcb)</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M510.144,-611.439C503.43,-606.427 496.022,-600.897 489.071,-595.708"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="484.813,-592.529 490.166,-593.717 486.816,-594.025 488.82,-595.52 488.82,-595.52 488.82,-595.52 486.816,-594.025 487.474,-597.323 484.813,-592.529 484.813,-592.529"/>
</g>
<!-- dissociateVCPUTCB(vcpu,\n tcb) -->
<g id="node10" class="node"><title>dissociateVCPUTCB(vcpu,\n tcb)</title>
<path fill="#ffffbf" stroke="#800000" d="M562.5,-556.5C562.5,-556.5 663.5,-556.5 663.5,-556.5 669.5,-556.5 675.5,-562.5 675.5,-568.5 675.5,-568.5 675.5,-580.5 675.5,-580.5 675.5,-586.5 669.5,-592.5 663.5,-592.5 663.5,-592.5 562.5,-592.5 562.5,-592.5 556.5,-592.5 550.5,-586.5 550.5,-580.5 550.5,-580.5 550.5,-568.5 550.5,-568.5 550.5,-562.5 556.5,-556.5 562.5,-556.5"/>
<text text-anchor="middle" x="613" y="-577.3" font-family="Consolas" font-size="9.00">dissociateVCPUTCB(vcpu,</text>
<text text-anchor="middle" x="613" y="-567.3" font-family="Consolas" font-size="9.00"> tcb)</text>
</g>
<!-- 可用于实现vm/vcpu的halt/resume&#45;&gt;dissociateVCPUTCB(vcpu,\n tcb) -->
<g id="edge7" class="edge"><title>可用于实现vm/vcpu的halt/resume&#45;&gt;dissociateVCPUTCB(vcpu,\n tcb)</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M558.753,-611.439C566.461,-606.332 574.981,-600.688 582.94,-595.415"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="587.295,-592.529 584.37,-597.167 585.211,-593.91 583.127,-595.291 583.127,-595.291 583.127,-595.291 585.211,-593.91 581.884,-593.415 587.295,-592.529 587.295,-592.529"/>
</g>
<!-- clear old associations of vcpu and tcb,\n then set vcpu pointer to the target one -->
<g id="node9" class="node"><title>clear old associations of vcpu and tcb,\n then set vcpu pointer to the target one</title>
<path fill="#ffffbf" stroke="#800000" d="M347,-465.5C347,-465.5 507,-465.5 507,-465.5 513,-465.5 519,-471.5 519,-477.5 519,-477.5 519,-489.5 519,-489.5 519,-495.5 513,-501.5 507,-501.5 507,-501.5 347,-501.5 347,-501.5 341,-501.5 335,-495.5 335,-489.5 335,-489.5 335,-477.5 335,-477.5 335,-471.5 341,-465.5 347,-465.5"/>
<text text-anchor="middle" x="427" y="-486.3" font-family="Consolas" font-size="9.00">clear old associations of vcpu and tcb,</text>
<text text-anchor="middle" x="427" y="-476.3" font-family="Consolas" font-size="9.00"> then set vcpu pointer to the target one</text>
</g>
<!-- associateVCPUTCB(vcpu,\n tcb)&#45;&gt;clear old associations of vcpu and tcb,\n then set vcpu pointer to the target one -->
<g id="edge6" class="edge"><title>associateVCPUTCB(vcpu,\n tcb)&#45;&gt;clear old associations of vcpu and tcb,\n then set vcpu pointer to the target one</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M455.252,-556.34C449.683,-542.181 441.744,-521.992 435.699,-506.62"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="433.728,-501.607 437.651,-505.437 434.643,-503.934 435.558,-506.261 435.558,-506.261 435.558,-506.261 434.643,-503.934 433.464,-507.084 433.728,-501.607 433.728,-501.607"/>
</g>
<!-- be in the foreground -->
<g id="node11" class="node"><title>be in the foreground</title>
<path fill="beige" stroke="#800000" d="M609.265,-498.991C609.265,-498.991 548.536,-486.009 548.536,-486.009 542.669,-484.754 542.669,-482.246 548.536,-480.991 548.536,-480.991 609.265,-468.009 609.265,-468.009 615.133,-466.754 626.867,-466.754 632.735,-468.009 632.735,-468.009 693.464,-480.991 693.464,-480.991 699.331,-482.246 699.331,-484.754 693.464,-486.009 693.464,-486.009 632.735,-498.991 632.735,-498.991 626.867,-500.246 615.133,-500.246 609.265,-498.991"/>
<text text-anchor="middle" x="621" y="-481.3" font-family="Consolas" font-size="9.00">be in the foreground</text>
</g>
<!-- dissociateVCPUTCB(vcpu,\n tcb)&#45;&gt;be in the foreground -->
<g id="edge8" class="edge"><title>dissociateVCPUTCB(vcpu,\n tcb)&#45;&gt;be in the foreground</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M614.542,-556.34C615.823,-542.09 617.653,-521.733 619.038,-506.325"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="619.489,-501.306 621.283,-506.487 619.266,-503.796 619.042,-506.286 619.042,-506.286 619.042,-506.286 619.266,-503.796 616.801,-506.084 619.489,-501.306 619.489,-501.306"/>
</g>
<!-- vcpu_invalidate_active -->
<g id="node12" class="node"><title>vcpu_invalidate_active</title>
<path fill="#ffffbf" stroke="#800000" d="M453.5,-402.5C453.5,-402.5 542.5,-402.5 542.5,-402.5 548.5,-402.5 554.5,-408.5 554.5,-414.5 554.5,-414.5 554.5,-426.5 554.5,-426.5 554.5,-432.5 548.5,-438.5 542.5,-438.5 542.5,-438.5 453.5,-438.5 453.5,-438.5 447.5,-438.5 441.5,-432.5 441.5,-426.5 441.5,-426.5 441.5,-414.5 441.5,-414.5 441.5,-408.5 447.5,-402.5 453.5,-402.5"/>
<text text-anchor="middle" x="498" y="-418.3" font-family="Consolas" font-size="9.00">vcpu_invalidate_active</text>
</g>
<!-- be in the foreground&#45;&gt;vcpu_invalidate_active -->
<g id="edge9" class="edge"><title>be in the foreground&#45;&gt;vcpu_invalidate_active</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M596.992,-470.594C580.106,-462.219 557.122,-450.821 537.551,-441.115"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="532.655,-438.687 538.134,-438.892 534.895,-439.797 537.134,-440.908 537.134,-440.908 537.134,-440.908 534.895,-439.797 536.135,-442.924 532.655,-438.687 532.655,-438.687"/>
<text text-anchor="middle" x="573.5" y="-449.8" font-family="Consolas" font-size="9.00">yes</text>
</g>
<!-- is running now -->
<g id="node13" class="node"><title>is running now</title>
<path fill="beige" stroke="#800000" d="M412.45,-356.245C412.45,-356.245 371.676,-344.755 371.676,-344.755 365.901,-343.127 365.901,-339.873 371.676,-338.245 371.676,-338.245 412.45,-326.755 412.45,-326.755 418.225,-325.127 429.775,-325.127 435.55,-326.755 435.55,-326.755 476.324,-338.245 476.324,-338.245 482.099,-339.873 482.099,-343.127 476.324,-344.755 476.324,-344.755 435.55,-356.245 435.55,-356.245 429.775,-357.873 418.225,-357.873 412.45,-356.245"/>
<text text-anchor="middle" x="424" y="-339.3" font-family="Consolas" font-size="9.00">is running now</text>
</g>
<!-- vcpu_invalidate_active&#45;&gt;is running now -->
<g id="edge10" class="edge"><title>vcpu_invalidate_active&#45;&gt;is running now</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M481.577,-402.411C469.383,-389.723 452.817,-372.486 440.585,-359.757"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="436.937,-355.962 442.024,-358.008 438.67,-357.764 440.402,-359.567 440.402,-359.567 440.402,-359.567 438.67,-357.764 438.78,-361.126 436.937,-355.962 436.937,-355.962"/>
</g>
<!-- is running now&#45;&gt;vcpu_disable() -->
<g id="edge11" class="edge"><title>is running now&#45;&gt;vcpu_disable()</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M424,-323.076C424,-310.178 424,-292.255 424,-276.885"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="424,-271.781 426.25,-276.781 424,-274.281 424,-276.781 424,-276.781 424,-276.781 424,-274.281 421.75,-276.782 424,-271.781 424,-271.781"/>
<text text-anchor="middle" x="431.5" y="-282.8" font-family="Consolas" font-size="9.00">yes</text>
</g>
<!-- 已封装的TCB操作入口 -->
<g id="node14" class="node"><title>已封装的TCB操作入口</title>
<path fill="#ffffbf" stroke="#800000" d="M105.5,-611.5C105.5,-611.5 314.5,-611.5 314.5,-611.5 320.5,-611.5 326.5,-617.5 326.5,-623.5 326.5,-623.5 326.5,-635.5 326.5,-635.5 326.5,-641.5 320.5,-647.5 314.5,-647.5 314.5,-647.5 105.5,-647.5 105.5,-647.5 99.5,-647.5 93.5,-641.5 93.5,-635.5 93.5,-635.5 93.5,-623.5 93.5,-623.5 93.5,-617.5 99.5,-611.5 105.5,-611.5"/>
<text text-anchor="middle" x="210" y="-636.3" font-family="Consolas" font-size="9.00">已封装的TCB操作入口</text>
<polyline fill="none" stroke="#800000" points="93.5,-629.5 326.5,-629.5 "/>
<text text-anchor="middle" x="210" y="-618.3" font-family="Consolas" font-size="9.00">注意：其实不一定包含完整虚拟化上下文的保存与恢复</text>
</g>
<!-- vcpu_stop(vcpu) -->
<g id="node15" class="node"><title>vcpu_stop(vcpu)</title>
<path fill="#ffffbf" stroke="#800000" d="M243,-465.5C243,-465.5 305,-465.5 305,-465.5 311,-465.5 317,-471.5 317,-477.5 317,-477.5 317,-489.5 317,-489.5 317,-495.5 311,-501.5 305,-501.5 305,-501.5 243,-501.5 243,-501.5 237,-501.5 231,-495.5 231,-489.5 231,-489.5 231,-477.5 231,-477.5 231,-471.5 237,-465.5 243,-465.5"/>
<text text-anchor="middle" x="274" y="-481.3" font-family="Consolas" font-size="9.00">vcpu_stop(vcpu)</text>
</g>
<!-- 已封装的TCB操作入口&#45;&gt;vcpu_stop(vcpu) -->
<g id="edge12" class="edge"><title>已封装的TCB操作入口&#45;&gt;vcpu_stop(vcpu)</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M216.616,-611.442C222.507,-596.464 231.488,-574.142 240,-555 247.342,-538.49 256.23,-520.111 263.077,-506.259"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="265.315,-501.744 265.11,-507.223 264.205,-503.984 263.094,-506.224 263.094,-506.224 263.094,-506.224 264.205,-503.984 261.078,-505.224 265.315,-501.744 265.315,-501.744"/>
</g>
<!-- vcpu_start(vcpu) -->
<g id="node18" class="node"><title>vcpu_start(vcpu)</title>
<path fill="#ffffbf" stroke="#800000" d="M28,-323.5C28,-323.5 92,-323.5 92,-323.5 98,-323.5 104,-329.5 104,-335.5 104,-335.5 104,-347.5 104,-347.5 104,-353.5 98,-359.5 92,-359.5 92,-359.5 28,-359.5 28,-359.5 22,-359.5 16,-353.5 16,-347.5 16,-347.5 16,-335.5 16,-335.5 16,-329.5 22,-323.5 28,-323.5"/>
<text text-anchor="middle" x="60" y="-339.3" font-family="Consolas" font-size="9.00">vcpu_start(vcpu)</text>
</g>
<!-- 已封装的TCB操作入口&#45;&gt;vcpu_start(vcpu) -->
<g id="edge17" class="edge"><title>已封装的TCB操作入口&#45;&gt;vcpu_start(vcpu)</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M210,-611.314C210,-600.942 210,-587.462 210,-575.5 210,-575.5 210,-575.5 210,-419.5 210,-373.743 152.961,-407.29 113,-385 102.378,-379.075 91.713,-371.027 82.7636,-363.528"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="78.5158,-359.902 83.7796,-361.437 80.4174,-361.525 82.3189,-363.148 82.3189,-363.148 82.3189,-363.148 80.4174,-361.525 80.8582,-364.86 78.5158,-359.902 78.5158,-359.902"/>
</g>
<!-- start_new_vcpu(vcpu,\n entry_address,\n target_cpu) -->
<g id="node21" class="node"><title>start_new_vcpu(vcpu,\n entry_address,\n target_cpu)</title>
<path fill="#ffffbf" stroke="#800000" d="M93,-555.5C93,-555.5 179,-555.5 179,-555.5 185,-555.5 191,-561.5 191,-567.5 191,-567.5 191,-581.5 191,-581.5 191,-587.5 185,-593.5 179,-593.5 179,-593.5 93,-593.5 93,-593.5 87,-593.5 81,-587.5 81,-581.5 81,-581.5 81,-567.5 81,-567.5 81,-561.5 87,-555.5 93,-555.5"/>
<text text-anchor="middle" x="136" y="-582.3" font-family="Consolas" font-size="9.00">start_new_vcpu(vcpu,</text>
<text text-anchor="middle" x="136" y="-572.3" font-family="Consolas" font-size="9.00"> entry_address,</text>
<text text-anchor="middle" x="136" y="-562.3" font-family="Consolas" font-size="9.00"> target_cpu)</text>
</g>
<!-- 已封装的TCB操作入口&#45;&gt;start_new_vcpu(vcpu,\n entry_address,\n target_cpu) -->
<g id="edge22" class="edge"><title>已封装的TCB操作入口&#45;&gt;start_new_vcpu(vcpu,\n entry_address,\n target_cpu)</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M186.179,-611.439C179.601,-606.727 172.383,-601.558 165.524,-596.646"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="161.308,-593.626 166.683,-594.708 163.341,-595.082 165.373,-596.538 165.373,-596.538 165.373,-596.538 163.341,-595.082 164.063,-598.367 161.308,-593.626 161.308,-593.626"/>
</g>
<!-- vcpu_hotplug_on(vcpu,\n entry_address) -->
<g id="node24" class="node"><title>vcpu_hotplug_on(vcpu,\n entry_address)</title>
<path fill="#ffffbf" stroke="#800000" d="M28,-510.5C28,-510.5 118,-510.5 118,-510.5 124,-510.5 130,-516.5 130,-522.5 130,-522.5 130,-534.5 130,-534.5 130,-540.5 124,-546.5 118,-546.5 118,-546.5 28,-546.5 28,-546.5 22,-546.5 16,-540.5 16,-534.5 16,-534.5 16,-522.5 16,-522.5 16,-516.5 22,-510.5 28,-510.5"/>
<text text-anchor="middle" x="73" y="-531.3" font-family="Consolas" font-size="9.00">vcpu_hotplug_on(vcpu,</text>
<text text-anchor="middle" x="73" y="-521.3" font-family="Consolas" font-size="9.00"> entry_address)</text>
</g>
<!-- 已封装的TCB操作入口&#45;&gt;vcpu_hotplug_on(vcpu,\n entry_address) -->
<g id="edge26" class="edge"><title>已封装的TCB操作入口&#45;&gt;vcpu_hotplug_on(vcpu,\n entry_address)</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M106.748,-611.414C90.5965,-606.722 77.4333,-600.959 72,-594 62.8733,-582.311 63.4561,-565.456 66.1456,-551.908"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="67.3102,-546.707 68.4132,-552.078 66.7639,-549.147 66.2176,-551.586 66.2176,-551.586 66.2176,-551.586 66.7639,-549.147 64.0219,-551.094 67.3102,-546.707 67.3102,-546.707"/>
</g>
<!-- vcpu_hotplug_off(vcpu) -->
<g id="node25" class="node"><title>vcpu_hotplug_off(vcpu)</title>
<path fill="#ffffbf" stroke="#800000" d="M261,-556.5C261,-556.5 353,-556.5 353,-556.5 359,-556.5 365,-562.5 365,-568.5 365,-568.5 365,-580.5 365,-580.5 365,-586.5 359,-592.5 353,-592.5 353,-592.5 261,-592.5 261,-592.5 255,-592.5 249,-586.5 249,-580.5 249,-580.5 249,-568.5 249,-568.5 249,-562.5 255,-556.5 261,-556.5"/>
<text text-anchor="middle" x="307" y="-572.3" font-family="Consolas" font-size="9.00">vcpu_hotplug_off(vcpu)</text>
</g>
<!-- 已封装的TCB操作入口&#45;&gt;vcpu_hotplug_off(vcpu) -->
<g id="edge28" class="edge"><title>已封装的TCB操作入口&#45;&gt;vcpu_hotplug_off(vcpu)</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M241.225,-611.439C250.831,-606.19 261.476,-600.374 271.355,-594.976"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="275.833,-592.529 272.524,-596.901 273.639,-593.728 271.445,-594.927 271.445,-594.927 271.445,-594.927 273.639,-593.728 270.367,-592.952 275.833,-592.529 275.833,-592.529"/>
</g>
<!-- seL4_TCB_Suspend(tcb) -->
<g id="node16" class="node"><title>seL4_TCB_Suspend(tcb)</title>
<path fill="#ffffbf" stroke="#800000" d="M241,-402.5C241,-402.5 337,-402.5 337,-402.5 343,-402.5 349,-408.5 349,-414.5 349,-414.5 349,-426.5 349,-426.5 349,-432.5 343,-438.5 337,-438.5 337,-438.5 241,-438.5 241,-438.5 235,-438.5 229,-432.5 229,-426.5 229,-426.5 229,-414.5 229,-414.5 229,-408.5 235,-402.5 241,-402.5"/>
<text text-anchor="middle" x="289" y="-418.3" font-family="Consolas" font-size="9.00">seL4_TCB_Suspend(tcb)</text>
</g>
<!-- vcpu_stop(vcpu)&#45;&gt;seL4_TCB_Suspend(tcb) -->
<g id="edge13" class="edge"><title>vcpu_stop(vcpu)&#45;&gt;seL4_TCB_Suspend(tcb)</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M278.258,-465.183C279.887,-458.559 281.769,-450.907 283.497,-443.877"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="284.783,-438.649 285.774,-444.042 284.186,-441.077 283.589,-443.505 283.589,-443.505 283.589,-443.505 284.186,-441.077 281.404,-442.967 284.783,-438.649 284.783,-438.649"/>
</g>
<!-- schedule in another new vm -->
<g id="node17" class="node"><title>schedule in another new vm</title>
<path fill="beige" stroke="#800000" d="M220.156,-357.57C220.156,-357.57 133.389,-343.43 133.389,-343.43 127.467,-342.465 127.467,-340.535 133.389,-339.57 133.389,-339.57 220.156,-325.43 220.156,-325.43 226.078,-324.465 237.922,-324.465 243.844,-325.43 243.844,-325.43 330.611,-339.57 330.611,-339.57 336.533,-340.535 336.533,-342.465 330.611,-343.43 330.611,-343.43 243.844,-357.57 243.844,-357.57 237.922,-358.535 226.078,-358.535 220.156,-357.57"/>
<text text-anchor="middle" x="232" y="-339.3" font-family="Consolas" font-size="9.00">schedule in another new vm</text>
</g>
<!-- seL4_TCB_Suspend(tcb)&#45;&gt;schedule in another new vm -->
<g id="edge14" class="edge"><title>seL4_TCB_Suspend(tcb)&#45;&gt;schedule in another new vm</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M276.35,-402.411C267.451,-390.39 255.529,-374.284 246.287,-361.8"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="243.263,-357.716 248.047,-360.396 244.751,-359.725 246.238,-361.734 246.238,-361.734 246.238,-361.734 244.751,-359.725 244.43,-363.073 243.263,-357.716 243.263,-357.716"/>
</g>
<!-- schedule in another new vm&#45;&gt;vcpu_disable() -->
<g id="edge16" class="edge"><title>schedule in another new vm&#45;&gt;vcpu_disable()</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M244.871,-325.402C257.375,-311.655 277.566,-291.762 299,-280 302.114,-278.291 311.292,-275.327 323.355,-271.832"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="328.303,-270.413 324.117,-273.954 325.9,-271.102 323.497,-271.791 323.497,-271.791 323.497,-271.791 325.9,-271.102 322.877,-269.628 328.303,-270.413 328.303,-270.413"/>
<text text-anchor="middle" x="359.5" y="-282.8" font-family="Consolas" font-size="9.00">no and current vm is running</text>
</g>
<!-- schedule in another new vm&#45;&gt;vcpu_save(vcpu,\n isActive) -->
<g id="edge15" class="edge"><title>schedule in another new vm&#45;&gt;vcpu_save(vcpu,\n isActive)</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M232,-323.076C232,-309.119 232,-289.278 232,-273.156"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="232,-267.845 234.25,-272.845 232,-270.345 232,-272.845 232,-272.845 232,-272.845 232,-270.345 229.75,-272.845 232,-267.845 232,-267.845"/>
<text text-anchor="middle" x="239.5" y="-282.8" font-family="Consolas" font-size="9.00">yes</text>
</g>
<!-- seL4_TCB_Resume(tcb) -->
<g id="node19" class="node"><title>seL4_TCB_Resume(tcb)</title>
<path fill="#ffffbf" stroke="#800000" d="M29.5,-226.5C29.5,-226.5 124.5,-226.5 124.5,-226.5 130.5,-226.5 136.5,-232.5 136.5,-238.5 136.5,-238.5 136.5,-250.5 136.5,-250.5 136.5,-256.5 130.5,-262.5 124.5,-262.5 124.5,-262.5 29.5,-262.5 29.5,-262.5 23.5,-262.5 17.5,-256.5 17.5,-250.5 17.5,-250.5 17.5,-238.5 17.5,-238.5 17.5,-232.5 23.5,-226.5 29.5,-226.5"/>
<text text-anchor="middle" x="77" y="-242.3" font-family="Consolas" font-size="9.00">seL4_TCB_Resume(tcb)</text>
</g>
<!-- vcpu_start(vcpu)&#45;&gt;seL4_TCB_Resume(tcb) -->
<g id="edge18" class="edge"><title>vcpu_start(vcpu)&#45;&gt;seL4_TCB_Resume(tcb)</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M63.1181,-323.076C65.8978,-307.541 69.9822,-284.717 73.0015,-267.845"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="73.9017,-262.814 75.2357,-268.132 73.4613,-265.275 73.0209,-267.736 73.0209,-267.736 73.0209,-267.736 73.4613,-265.275 70.8061,-267.339 73.9017,-262.814 73.9017,-262.814"/>
</g>
<!-- has another VM in the foreground -->
<g id="node20" class="node"><title>has another VM in the foreground</title>
<path fill="beige" stroke="#800000" d="M259.115,-191.842C259.115,-191.842 153.872,-177.158 153.872,-177.158 147.93,-176.329 147.93,-174.671 153.872,-173.842 153.872,-173.842 259.115,-159.158 259.115,-159.158 265.058,-158.329 276.942,-158.329 282.885,-159.158 282.885,-159.158 388.128,-173.842 388.128,-173.842 394.07,-174.671 394.07,-176.329 388.128,-177.158 388.128,-177.158 282.885,-191.842 282.885,-191.842 276.942,-192.671 265.058,-192.671 259.115,-191.842"/>
<text text-anchor="middle" x="271" y="-173.3" font-family="Consolas" font-size="9.00">has another VM in the foreground</text>
</g>
<!-- seL4_TCB_Resume(tcb)&#45;&gt;has another VM in the foreground -->
<g id="edge19" class="edge"><title>seL4_TCB_Resume(tcb)&#45;&gt;has another VM in the foreground</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M119.656,-226.422C128.024,-223.2 136.762,-219.926 145,-217 172.302,-207.302 203.277,-197.332 227.683,-189.711"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="232.474,-188.219 228.37,-191.854 230.087,-188.962 227.7,-189.706 227.7,-189.706 227.7,-189.706 230.087,-188.962 227.031,-187.558 232.474,-188.219 232.474,-188.219"/>
</g>
<!-- has another VM in the foreground&#45;&gt;vcpu_enable(vcpu) -->
<g id="edge21" class="edge"><title>has another VM in the foreground&#45;&gt;vcpu_enable(vcpu)</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M278.877,-158.297C290.782,-135.435 315.464,-93.8455 348,-70 362.221,-59.5772 379.825,-52.1361 396.332,-46.9002"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="401.414,-45.3452 397.291,-48.9596 399.024,-46.0766 396.633,-46.808 396.633,-46.808 396.633,-46.808 399.024,-46.0766 395.975,-44.6565 401.414,-45.3452 401.414,-45.3452"/>
<text text-anchor="middle" x="353.5" y="-95.3" font-family="Consolas" font-size="9.00">no</text>
</g>
<!-- has another VM in the foreground&#45;&gt;vcpu_restore() -->
<g id="edge20" class="edge"><title>has another VM in the foreground&#45;&gt;vcpu_restore()</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M301.195,-161.608C323.605,-152.04 355.017,-138.627 383.124,-126.627"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="387.966,-124.559 384.251,-128.592 385.667,-125.541 383.368,-126.523 383.368,-126.523 383.368,-126.523 385.667,-125.541 382.484,-124.453 387.966,-124.559 387.966,-124.559"/>
<text text-anchor="middle" x="372.5" y="-135.8" font-family="Consolas" font-size="9.00">yes</text>
</g>
<!-- vm_assign_vcpu_target(vcpu,\n target_cpu) -->
<g id="node22" class="node"><title>vm_assign_vcpu_target(vcpu,\n target_cpu)</title>
<path fill="#ffffbf" stroke="#800000" d="M59.5,-465.5C59.5,-465.5 178.5,-465.5 178.5,-465.5 184.5,-465.5 190.5,-471.5 190.5,-477.5 190.5,-477.5 190.5,-489.5 190.5,-489.5 190.5,-495.5 184.5,-501.5 178.5,-501.5 178.5,-501.5 59.5,-501.5 59.5,-501.5 53.5,-501.5 47.5,-495.5 47.5,-489.5 47.5,-489.5 47.5,-477.5 47.5,-477.5 47.5,-471.5 53.5,-465.5 59.5,-465.5"/>
<text text-anchor="middle" x="119" y="-486.3" font-family="Consolas" font-size="9.00">vm_assign_vcpu_target(vcpu,</text>
<text text-anchor="middle" x="119" y="-476.3" font-family="Consolas" font-size="9.00"> target_cpu)</text>
</g>
<!-- start_new_vcpu(vcpu,\n entry_address,\n target_cpu)&#45;&gt;vm_assign_vcpu_target(vcpu,\n target_cpu) -->
<g id="edge23" class="edge"><title>start_new_vcpu(vcpu,\n entry_address,\n target_cpu)&#45;&gt;vm_assign_vcpu_target(vcpu,\n target_cpu)</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M136.295,-555.419C136.092,-542.553 134.968,-524.965 131,-510 130.705,-508.886 130.362,-507.76 129.983,-506.636"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="128.126,-501.744 132.004,-505.62 129.013,-504.081 129.9,-506.418 129.9,-506.418 129.9,-506.418 129.013,-504.081 127.797,-507.217 128.126,-501.744 128.126,-501.744"/>
</g>
<!-- vcpu_set_boot_args(vcpu,\n entry_address) -->
<g id="node23" class="node"><title>vcpu_set_boot_args(vcpu,\n entry_address)</title>
<path fill="#ffffbf" stroke="#800000" d="M28,-402.5C28,-402.5 132,-402.5 132,-402.5 138,-402.5 144,-408.5 144,-414.5 144,-414.5 144,-426.5 144,-426.5 144,-432.5 138,-438.5 132,-438.5 132,-438.5 28,-438.5 28,-438.5 22,-438.5 16,-432.5 16,-426.5 16,-426.5 16,-414.5 16,-414.5 16,-408.5 22,-402.5 28,-402.5"/>
<text text-anchor="middle" x="80" y="-423.3" font-family="Consolas" font-size="9.00">vcpu_set_boot_args(vcpu,</text>
<text text-anchor="middle" x="80" y="-413.3" font-family="Consolas" font-size="9.00"> entry_address)</text>
</g>
<!-- vm_assign_vcpu_target(vcpu,\n target_cpu)&#45;&gt;vcpu_set_boot_args(vcpu,\n entry_address) -->
<g id="edge24" class="edge"><title>vm_assign_vcpu_target(vcpu,\n target_cpu)&#45;&gt;vcpu_set_boot_args(vcpu,\n entry_address)</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M107.928,-465.183C103.527,-458.299 98.4167,-450.306 93.7797,-443.053"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="90.9642,-438.649 95.5532,-441.65 92.3109,-440.755 93.6576,-442.862 93.6576,-442.862 93.6576,-442.862 92.3109,-440.755 91.7619,-444.074 90.9642,-438.649 90.9642,-438.649"/>
</g>
<!-- vcpu_set_boot_args(vcpu,\n entry_address)&#45;&gt;vcpu_start(vcpu) -->
<g id="edge25" class="edge"><title>vcpu_set_boot_args(vcpu,\n entry_address)&#45;&gt;vcpu_start(vcpu)</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M75.5614,-402.411C72.6613,-391.246 68.8463,-376.558 65.7195,-364.52"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="64.4262,-359.541 67.861,-363.815 65.0548,-361.961 65.6833,-364.38 65.6833,-364.38 65.6833,-364.38 65.0548,-361.961 63.5056,-364.946 64.4262,-359.541 64.4262,-359.541"/>
</g>
<!-- vcpu_hotplug_on(vcpu,\n entry_address)&#45;&gt;vcpu_set_boot_args(vcpu,\n entry_address) -->
<g id="edge27" class="edge"><title>vcpu_hotplug_on(vcpu,\n entry_address)&#45;&gt;vcpu_set_boot_args(vcpu,\n entry_address)</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M44.1495,-510.397C41.7026,-507.88 39.568,-505.082 38,-502 30.5441,-487.343 31.8405,-480.247 38,-465 41.4504,-456.459 47.4701,-448.662 53.8924,-442.103"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="57.488,-438.589 55.4844,-443.693 55.6999,-440.337 53.9118,-442.084 53.9118,-442.084 53.9118,-442.084 55.6999,-440.337 52.3393,-440.475 57.488,-438.589 57.488,-438.589"/>
</g>
<!-- vcpu_hotplug_off(vcpu)&#45;&gt;vcpu_stop(vcpu) -->
<g id="edge29" class="edge"><title>vcpu_hotplug_off(vcpu)&#45;&gt;vcpu_stop(vcpu)</title>
<path fill="none" stroke="black" stroke-width="0.5" d="M300.637,-556.34C295.387,-542.181 287.902,-521.992 282.202,-506.62"/>
<polygon fill="black" stroke="black" stroke-width="0.5" points="280.343,-501.607 284.191,-505.513 281.212,-503.951 282.082,-506.296 282.082,-506.296 282.082,-506.296 281.212,-503.951 279.972,-507.078 280.343,-501.607 280.343,-501.607"/>
</g>
</g>
</svg>
